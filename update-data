#!/usr/bin/env perl
use strict;
use warnings;
use autodie;

# Create a CSV that can be viewed directly on GitHub...
system "echo 'Date,Term,Count' > jobs-count_for-github.csv";
system "cat jobs-count.csv | sed 's/;/,/g' >> jobs-count_for-github.csv";

my %regex = (
    "Scripting languages" => '^(python|perl|ruby|shell|bash)$',
    "Operating systems"   => '^(linux|windows)$',
    "Certifications"      => '^(ccna|cissp|lpic)$',
    "Linux scripting"      => '^(linux perl|linux python|linux ruby|linux bash|linux shell)$',
    "Monitoring"          => '^(zabbix|nagios|icinga)$',
    "Databases"           => '^(mysql|postgresql|oracle)$',
    "Web servers"         => '^(apache|nginx|lighttpd)$',
    "Configuration mngt"  => '^(puppet|chef|salt|cfengine|ansible)$',
    "DevOps"              => '^(devops|cloud|aws|agile|scrum)$',
    "Other"               => '^(cluster|bind|haproxy|memcache|redis|jenkins|docker)$',
);

print "Generate graphs\n"
for my $title ( keys %regex ) {
    print "--> generating '$title' graph ..."
    system "./gen-graph --select '$regex{$title}' --xskip 50 --title '$title'";
    print " done\n"
}

print "Commit and push\n"
system "git commit -am 'updated data' && git push";
